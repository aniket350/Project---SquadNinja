import { Component, OnInit ,Input} from '@angular/core';
import { $, element } from 'protractor';
import { FormControl } from '@angular/forms';
import {AutogenerateService} from '../../services/autogenServices/autogenerate.service';
import {HttpClient} from '@angular/common/http';
import { map } from 'rxjs/operators';
@Component({
  selector: 'app-auto-generate-team',
  templateUrl: './auto-generate-team.component.html',
  styleUrls: ['./auto-generate-team.component.scss']
})
export class AutoGenerateTeamComponent implements OnInit {
  public items: any;
  public postedIdeaDetails: any;
 
  title:any="";
  obj1:any="";
  obj:any="";
  disabled:boolean=true;
  cards = [];
  roleCards=[];
  tabs=[];
  response:any;
  x: any = [];
  accept:any=[];
  sendAccept={
    role:{
      role:"",
      experience:"",
      skills:[],
    }
}
  toSendData = new Map();
  constructor(private autogenerate : AutogenerateService, private http:HttpClient,private autogeneratesp:AutogenerateService) { }
  ngOnInit() {
     let  disp=[];
// this.getPostedIdeas(); 
    this.title=localStorage.getItem("title");
    this.obj=localStorage.getItem("Role");
    this.obj1=JSON.parse(this.obj);
    for(let role of this.obj1){
        this.tabs.push(role.role);
        this.getAnyTeam(role.role);
        disp=this.cards;
        console.log(this.cards);
      }
     
}
sendAutogenTeam(){
  console.log(this.toSendData);
  for(let [key,value] of this.toSendData){
    this.accept.push(value);
  }
  this.toSendData = null;
  console.log(this.accept);
  console.log(this.accept.length);
  let i =0;
  ['currentLocation' ,'domain','id' ,'idea','preferredLocation', 'ideaDto' , 'previousProject', 'skillList','subDomain'].forEach(element => 
  this.accept.forEach(e => {
      delete e[element];
    })
  );
  this.accept = this.accept.map(element => {
      this.sendAccept.role.role = element.role;
      this.sendAccept.role.experience = element.experience;
      this.sendAccept.role.skills = element.skills; 
      element.role = this.sendAccept.role; 
      ['experience','skills'].forEach( e => delete element[e]);
      return element;
   });
  console.log(this.accept);
  this.autogeneratesp.sendAutogeneratedTeam(this.accept,this.title).subscribe((data)=>{
  this.response=data;
  });
}
addCards(toAdd){
  console.log(toAdd);
  this.cards.push(toAdd);
  console.log(this.cards);
}
getAnyTeam(role:any){
  // console.log(role);
  this.autogeneratesp.getByIdeaTitleAndRoleName(this.title,role)
  .subscribe(data =>{
    this.cards=data;
    this.roleCards.push(this.cards)
    // this.addCards(this.cards);
    console.log("after getting back from service",this.roleCards);
  }
  ); 
  // console.log(this.cards);
}
// for autogeneration team
// getTab(value: any) {
//   console.log(value, 'currentIndex');
//   this.autogenerate.participantsByRole(this.postedIdeaDetails.role[value].role).subscribe((response) => {
//   console.log(response);
//   if (response) {
//      response = response.map(e => {
//       e.acceptStatus = 'Accept';
//       e.rejectStatus = 'Reject';
//       return e
//     })
//     this.items = response;
//     console.log(this.items);
//     }
//     }, (err) => {
//     console.log(err);
//   });
// }
// getPostedIdeas() {
//   this.autogenerate.posetedIdeas().subscribe((response) => {
//     console.log(response);
//     if (response) {
//       this.postedIdeaDetails = response;
//       console.log(response);
//       this.getTab(0);
//       }
//     }, (err) => {
//       console.log(err);
//   });
//  }
// clickedAccept(item, role) {
//   this.items = this.items.map(e => {
//     if (item.Emailid == e.Emailid) {
//       e.rejectStatus = 'Reject';
//       e.acceptStatus = 'Accepted';
//     }
//     return e;
//  })
// }
// clickedReject(item , role) {
//   console.log(item, role);
//   this.items = this.items.map(e => {
//       if (item.Emailid == e.Emailid) {
//         e.rejectStatus = 'Rejected';
//         e.acceptStatus = 'Accept';
//       }
//       return e;
//   })
// }
clickedAccept(index,i){
 
  this.disabled=false;
  console.log(this.roleCards[index][i]);
  this.toSendData.set(2*index+1*i,this.roleCards[index][i]);
  console.log(this.toSendData);
  console.log(index);
  console.log(i);
  console.log("Accepted");
}
clickedReject(index,i){
  this.toSendData.delete(2*index+1*i);
  console.log(this.toSendData);
  console.log(index);
  console.log(i);
  console.log("Rejected");
}
}